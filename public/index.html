[file name]: index.html
[file content begin]
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Single User Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f8fafc;
      --panel: #ffffff;
      --muted: #64748b;
      --text: #1e293b;
      --accent: #0891b2;
      --good: #16a34a;
      --warn: #d97706;
      --bad: #dc2626;
      --chip: #f1f5f9;
      --weekend: #7c3aed;
    }
    
    * { box-sizing: border-box; }
    
    body {
      margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
    }
    
    header {
      padding: 16px 20px;
      border-bottom: 1px solid #e2e8f0;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 16px;
    }
    
    h1 { margin: 0; font-size: 20px; }
    .accent { color: var(--accent); }
    .weekend { color: var(--weekend); }
    
    .wrap { padding: 20px; max-width: 1400px; margin: 0 auto; }
    
    .grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
      gap: 20px; 
      margin-bottom: 20px;
    }
    
    .card { 
      background: var(--panel);
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    
    .card-header { 
      padding: 16px;
      border-bottom: 1px solid #e2e8f0;
      background: rgba(241, 245, 249, 0.7);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-header h2 { 
      margin: 0; 
      font-size: 16px;
      font-weight: 600;
    }
    
    .card-content { padding: 16px; }
    
    .controls { display: flex; gap: 8px; flex-wrap: wrap; }
    
    .btn {
      background: var(--chip);
      border: 1px solid #cbd5e1;
      color: var(--text);
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.15s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    
    .btn:hover { 
      border-color: var(--accent);
      color: var(--accent);
      background: #f0fdff;
    }
    
    .btn-primary {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }
    
    .btn-primary:hover {
      background: #0c8599;
      border-color: #0c8599;
      color: white;
    }
    
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .status-active { background: #dcfce7; color: #166534; }
    .status-inactive { background: #fee2e2; color: #991b1b; }
    
    .info-grid {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 12px 16px;
      align-items: start;
    }
    
    .info-label {
      color: var(--muted);
      font-size: 13px;
      white-space: nowrap;
    }
    
    .info-value {
      font-size: 13px;
      word-break: break-word;
    }
    
    .time-display {
      font-family: ui-monospace, monospace;
      background: var(--chip);
      padding: 4px 8px;
      border-radius: 6px;
      border: 1px solid #cbd5e1;
      font-size: 12px;
    }
    
    .ok { color: var(--good); }
    .warn { color: var(--warn); }
    .bad { color: var(--bad); }
    
    .logs-panel {
      background: #f1f5f9;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      padding: 12px;
      max-height: 400px;
      overflow: auto;
      font-family: ui-monospace, monospace;
      font-size: 12px;
      line-height: 1.4;
    }
    
    .log-entry {
      padding: 4px 0;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .log-time { color: var(--muted); }
    
    .separator {
      height: 1px;
      background: #e2e8f0;
      margin: 16px 0;
    }
    
    .auto-refresh {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }
    
    .auto-refresh input[type="checkbox"] {
      accent-color: var(--accent);
    }
    
    @media (max-width: 768px) {
      .grid { grid-template-columns: 1fr; }
      header { flex-direction: column; align-items: stretch; }
      .controls { justify-content: center; }
    }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>Single User <span class="accent">Dashboard</span> <span id="weekendIndicator" class="weekend" style="display:none;">(Weekend Mode)</span></h1>
      <div class="auto-refresh">
        <input type="checkbox" id="autoRefresh" />
        <label for="autoRefresh">Auto-refresh (10s)</label>
      </div>
    </div>
    <div class="controls">
      <button class="btn" id="refreshBtn">üîÑ Refresh</button>
      <button class="btn" id="refreshTokenBtn">üîë Refresh Token</button>
      <button class="btn" id="spinBtn">üé∞ Manual Spin</button>
      <button class="btn" id="claimBtn">üèÜ Claim Achievements</button>
      <button class="btn" id="fundsBtn">üí∞ Check Funds</button>
      <a href="tools.html" class="btn btn-primary">üõ†Ô∏è Open Tools</a>
    </div>
  </header>

  <div class="wrap">
    <div class="grid">
      <!-- User Status Card -->
      <div class="card">
        <div class="card-header">
          <h2>User Status</h2>
          <span id="statusBadge" class="status-badge status-inactive">Inactive</span>
        </div>
        <div class="card-content">
          <div class="info-grid">
            <div class="info-label">User ID:</div>
            <div class="info-value" id="userId">Loading...</div>
            
            <div class="info-label">Token Status:</div>
            <div class="info-value">
              <span id="tokenStatus">Unknown</span>
              <div class="time-display" id="lastRefresh">‚Äî</div>
            </div>
            
            <div class="info-label">Active Window:</div>
            <div class="info-value">
              <div id="activeWindowStatus">Checking...</div>
              <div class="time-display" id="windowTimes">‚Äî</div>
            </div>
            
            <div class="info-label">Weekend Mode:</div>
            <div class="info-value" id="weekendMode">Checking...</div>
          </div>
        </div>
      </div>

      <!-- Statistics Card -->
      <div class="card">
        <div class="card-header">
          <h2>Statistics</h2>
        </div>
        <div class="card-content">
          <div class="info-grid">
            <div class="info-label">Total Spins:</div>
            <div class="info-value" id="totalSpins">0</div>
            
            <div class="info-label">Achievements Claimed:</div>
            <div class="info-value" id="achievementsClaimed">0</div>
            
            <div class="info-label">Current Funds:</div>
            <div class="info-value" id="currentFunds">0</div>
            
            <div class="info-label">Funds Checks Today:</div>
            <div class="info-value" id="fundsChecks">0</div>
            
            <div class="info-label">Next Spin:</div>
            <div class="info-value">
              <div class="time-display" id="nextSpinTime">‚Äî</div>
              <div id="nextSpinCountdown" style="font-size: 11px; color: var(--muted); margin-top: 2px;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Schedule Card -->
      <div class="card">
        <div class="card-header">
          <h2>Daily Schedule</h2>
        </div>
        <div class="card-content">
          <div class="info-grid">
            <div class="info-label">Start Time (CET):</div>
            <div class="info-value" id="dayStart">07:40 ¬±22m</div>
            
            <div class="info-label">End Time (CET):</div>
            <div class="info-value" id="dayEnd">23:59</div>
            
            <div class="info-label">Spin Interval:</div>
            <div class="info-value" id="spinInterval">30+0-21m</div>
            
            <div class="info-label">Achievement #1:</div>
            <div class="info-value">
              <div class="time-display" id="ach1Time">‚Äî</div>
              <div id="ach1Countdown" style="font-size: 11px; color: var(--muted); margin-top: 2px;"></div>
            </div>
            
            <div class="info-label">Achievement #2:</div>
            <div class="info-value">
              <div class="time-display" id="ach2Time">‚Äî</div>
              <div id="ach2Countdown" style="font-size: 11px; color: var(--muted); margin-top: 2px;"></div>
            </div>
            
            <div class="info-label">Achievement #3:</div>
            <div class="info-value">
              <div class="time-display" id="ach3Time">‚Äî</div>
              <div id="ach3Countdown" style="font-size: 11px; color: var(--muted); margin-top: 2px;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Activity Logs Card -->
    <div class="card">
      <div class="card-header">
        <h2>Activity Logs</h2>
        <div class="controls">
          <button class="btn" id="clearLogsBtn">Clear Logs</button>
        </div>
      </div>
      <div class="card-content">
        <div class="logs-panel" id="activityLogs">
          Loading activity logs...
        </div>
      </div>
    </div>
  </div>

  <script>
    // Configuration
    const DEBUG_LIMIT = 100;
    let refreshInterval = null;
    let lastData = null;

    // Formatting functions
    function formatTime(iso) {
      if (!iso) return '‚Äî';
      try {
        const d = new Date(iso);
        if (isNaN(d)) return '‚Äî';
        return d.toLocaleString();
      } catch {
        return '‚Äî';
      }
    }

    function formatUTC(iso) {
      if (!iso) return '‚Äî';
      try {
        const d = new Date(iso);
        if (isNaN(d)) return '‚Äî';
        return d.toUTCString().replace('GMT', 'UTC');
      } catch {
        return '‚Äî';
      }
    }

    function timeUntil(iso) {
      if (!iso) return '';
      try {
        const d = new Date(iso);
        const diff = Math.round((d.getTime() - Date.now()) / 60000);
        if (isNaN(diff)) return '';
        if (diff > 0) return `in ${diff}m`;
        if (diff < 0) return `${Math.abs(diff)}m ago`;
        return 'now';
      } catch {
        return '';
      }
    }

    // API functions
    async function fetchUserData() {
      try {
        const response = await fetch('/api/user');
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        return await response.json();
      } catch (error) {
        console.error('Failed to fetch user data:', error);
        return null;
      }
    }

    async function fetchActivityLogs() {
      try {
        const response = await fetch('/api/activity?limit=50');
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        return await response.json();
      } catch (error) {
        console.error('Failed to fetch activity logs:', error);
        return [];
      }
    }

    async function performAction(endpoint) {
      try {
        const response = await fetch(endpoint, { method: 'POST' });
        const data = await response.json();
        if (!response.ok) throw new Error(data.message || 'Action failed');
        return data;
      } catch (error) {
        alert(`Error: ${error.message}`);
        throw error;
      }
    }

    // Update UI functions
    function updateUserStatus(data) {
      // Status badge
      const statusBadge = document.getElementById('statusBadge');
      if (data.isActive) {
        statusBadge.textContent = 'Active';
        statusBadge.className = 'status-badge status-active';
      } else {
        statusBadge.textContent = 'Inactive';
        statusBadge.className = 'status-badge status-inactive';
      }

      // Basic info
      document.getElementById('userId').textContent = data.userId || 'Not set';
      document.getElementById('tokenStatus').textContent = data.jwtToken ? 'Valid' : 'Missing';
      document.getElementById('lastRefresh').textContent = formatTime(data.lastRefresh);
      
      // Active window
      const now = new Date();
      const start = data._effectiveStartUTC ? new Date(data._effectiveStartUTC) : null;
      const end = data._effectiveEndUTC ? new Date(data._effectiveEndUTC) : null;
      
      if (start && end) {
        const isActive = now >= start && now <= end;
        document.getElementById('activeWindowStatus').textContent = isActive ? '‚úÖ Active' : '‚è∏Ô∏è Inactive';
        document.getElementById('windowTimes').textContent = 
          `${formatTime(start)} - ${formatTime(end)}`;
      }

      // Weekend mode
      const isWeekend = data._isWeekend;
      document.getElementById('weekendMode').textContent = isWeekend ? '‚úÖ Yes' : 'No';
      document.getElementById('weekendIndicator').style.display = isWeekend ? 'inline' : 'none';
    }

    function updateStatistics(data) {
      document.getElementById('totalSpins').textContent = data.spinCount || 0;
      document.getElementById('achievementsClaimed').textContent = data.achievementsClaimed || 0;
      document.getElementById('currentFunds').textContent = data.lastFunds?.toLocaleString() || '0';
      document.getElementById('fundsChecks').textContent = data.dailyFundsChecks || 0;
      
      // Next spin
      const nextSpinEl = document.getElementById('nextSpinTime');
      const countdownEl = document.getElementById('nextSpinCountdown');
      if (data.nextSpinTime) {
        nextSpinEl.textContent = formatTime(data.nextSpinTime);
        countdownEl.textContent = timeUntil(data.nextSpinTime);
      } else {
        nextSpinEl.textContent = '‚Äî';
        countdownEl.textContent = '';
      }
    }

    function updateSchedule(data) {
      // Current schedule
      document.getElementById('dayStart').textContent = `${data.dayStart} ¬±${data.jitter}m`;
      document.getElementById('dayEnd').textContent = data.dayEnd;
      document.getElementById('spinInterval').textContent = 
        `${data.baseInterval}+${data.randomScale1}-${data.randomScale2}m`;
      
      // Calculate achievement times
      const start = data._effectiveStartUTC ? new Date(data._effectiveStartUTC) : null;
      const end = data._effectiveEndUTC ? new Date(data._effectiveEndUTC) : null;
      
      if (start) {
        const ach1 = new Date(start.getTime() + 5 * 60000);
        const ach2 = new Date(ach1.getTime() + 5 * 60 * 60000);
        
        document.getElementById('ach1Time').textContent = formatTime(ach1);
        document.getElementById('ach1Countdown').textContent = timeUntil(ach1);
        
        document.getElementById('ach2Time').textContent = formatTime(ach2);
        document.getElementById('ach2Countdown').textContent = timeUntil(ach2);
      }
      
      if (end) {
        const ach3 = new Date(end.getTime() - 5 * 60000);
        document.getElementById('ach3Time').textContent = formatTime(ach3);
        document.getElementById('ach3Countdown').textContent = timeUntil(ach3);
      }
    }

    function updateActivityLogs(logs) {
      const container = document.getElementById('activityLogs');
      if (!logs || logs.length === 0) {
        container.innerHTML = '<div class="log-entry">No activity logs yet.</div>';
        return;
      }
      
      const html = logs.map(log => `
        <div class="log-entry">
          <span class="log-time">[${new Date(log.timestamp).toLocaleTimeString()}]</span>
          ${log.message}
        </div>
      `).join('');
      
      container.innerHTML = html;
      container.scrollTop = 0;
    }

    // Main update function
    async function updateAll() {
      try {
        const [userData, activityLogs] = await Promise.all([
          fetchUserData(),
          fetchActivityLogs()
        ]);
        
        if (userData) {
          // Store for comparison
          lastData = userData;
          
          // Update all sections
          updateUserStatus(userData);
          updateStatistics(userData);
          updateSchedule(userData);
          
          // Check if it's weekend
          const now = new Date();
          const isWeekend = now.getUTCDay() === 0 || now.getUTCDay() === 6;
          userData._isWeekend = isWeekend;
        }
        
        updateActivityLogs(activityLogs);
        
      } catch (error) {
        console.error('Failed to update dashboard:', error);
      }
    }

    // Event listeners
    document.getElementById('refreshBtn').addEventListener('click', updateAll);
    
    document.getElementById('refreshTokenBtn').addEventListener('click', async () => {
      try {
        await performAction('/api/refresh');
        await updateAll();
      } catch (error) {
        // Error already shown by performAction
      }
    });
    
    document.getElementById('spinBtn').addEventListener('click', async () => {
      try {
        await performAction('/api/spin');
        await updateAll();
      } catch (error) {
        // Error already shown by performAction
      }
    });
    
    document.getElementById('claimBtn').addEventListener('click', async () => {
      try {
        await performAction('/api/claim-achievements');
        await updateAll();
      } catch (error) {
        // Error already shown by performAction
      }
    });
    
    document.getElementById('fundsBtn').addEventListener('click', async () => {
      try {
        await performAction('/api/check-funds');
        await updateAll();
      } catch (error) {
        // Error already shown by performAction
      }
    });
    
    document.getElementById('clearLogsBtn').addEventListener('click', () => {
      if (confirm('Clear all activity logs?')) {
        // This would need a backend endpoint to clear logs
        alert('Log clearing not implemented in this version');
      }
    });
    
    // Auto-refresh toggle
    document.getElementById('autoRefresh').addEventListener('change', (e) => {
      if (e.target.checked) {
        refreshInterval = setInterval(updateAll, 10000);
      } else {
        if (refreshInterval) {
          clearInterval(refreshInterval);
          refreshInterval = null;
        }
      }
    });

    // Initial load
    updateAll();
  </script>
</body>
</html>
[file content end]